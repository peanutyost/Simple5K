{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container py-3 py-md-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">List of Races</h1>
            {% if object_list %}
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover sortable-table">
                    <thead class="table-light">
                        <tr>
                            <th scope="col" data-order-by="name" data-order-direction="asc">Name <span aria-hidden="true">↑</span></th>
                            <th scope="col" data-order-by="date">Date</th>
                            <th scope="col" data-order-by="status">Status</th>
                            <th scope="col" data-order-by="distance">Distance (m)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for race in object_list %}
                        <tr>
                            <td><a href="{{ race.get_absolute_edit_url }}" class="text-decoration-none">{{ race.name }}</a></td>
                            <td>{{ race.date }}</td>
                            <td>{{ race.get_status_display|default:race.status }}</td>
                            <td>{{ race.distance }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">No races found.</p>
            {% endif %}
        </div>
    </div>
</div>
<script>
(function() {
    var table = document.querySelector('.sortable-table');
    if (!table || !table.tHead) return;
    var ths = table.tHead.querySelectorAll('th');
    ths.forEach(function(th, index) {
        th.setAttribute('tabindex', '0');
        th.setAttribute('role', 'button');
        th.addEventListener('click', function() { sortTable(index); });
    });
    function sortTable(colIndex) {
        var tbody = table.querySelector('tbody');
        if (!tbody) return;
        var rows = Array.prototype.slice.call(tbody.querySelectorAll('tr'));
        var dir = (tbody.getAttribute('data-sort-dir') === 'asc' && parseInt(tbody.getAttribute('data-sort-col'), 10) === colIndex) ? -1 : 1;
        tbody.setAttribute('data-sort-col', colIndex);
        tbody.setAttribute('data-sort-dir', dir === 1 ? 'asc' : 'desc');
        rows.sort(function(a, b) {
            var aVal = (a.cells[colIndex] && a.cells[colIndex].textContent) ? a.cells[colIndex].textContent.trim() : '';
            var bVal = (b.cells[colIndex] && b.cells[colIndex].textContent) ? b.cells[colIndex].textContent.trim() : '';
            return dir * (aVal < bVal ? -1 : aVal > bVal ? 1 : 0);
        });
        rows.forEach(function(r) { tbody.appendChild(r); });
        ths.forEach(function(th, i) {
            var span = th.querySelector('span');
            if (span) span.textContent = (i === colIndex) ? (dir === 1 ? '↑' : '↓') : '↑';
        });
    }
})();
</script>
{% endblock %}
