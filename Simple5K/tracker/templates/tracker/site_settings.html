{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container py-3 py-md-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8">
            <h1 class="mb-4">Settings</h1>

            {% if messages %}
            <div class="mb-3">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}

            <div class="card mb-4">
                <div class="card-header">PayPal (signup payment)</div>
                <div class="card-body">
                    <p class="text-muted small mb-4">
                        When enabled, new signups are sent to PayPal with the race entry fee. After they pay, they are marked as paid. If disabled, signup goes to the success page and runners can pay on race day.
                    </p>
                    <form method="post" action="{% url 'tracker:site-settings' %}">
                        {% csrf_token %}
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                {{ form.paypal_enabled }}
                                <label class="form-check-label" for="{{ form.paypal_enabled.id_for_label }}">{{ form.paypal_enabled.label }}</label>
                            </div>
                            <small class="form-text text-muted">PayPal business email and sandbox mode are set via <code>PAYPAL_BUSINESS_EMAIL</code> and <code>PAYPAL_SANDBOX</code> in your environment.</small>
                        </div>
                        <hr class="my-4">
                        <h5 class="mb-3">Signup confirmation email</h5>
                        <p class="text-muted small mb-4">
                            A background worker (same process as “Send Email” race emails) runs every 5 minutes. It sends a confirmation email to runners who have not received one yet and either have paid (PayPal) or signed up more than <strong>X minutes ago</strong>. Set X below. If PayPal is enabled, unpaid runners get the email with a pay-later link after X minutes. Set the site base URL so that link works.
                        </p>
                        <div class="mb-4">
                            <label for="{{ form.signup_confirmation_timeout_minutes.id_for_label }}" class="form-label">{{ form.signup_confirmation_timeout_minutes.label }}</label>
                            {{ form.signup_confirmation_timeout_minutes }}
                            {% if form.signup_confirmation_timeout_minutes.help_text %}<small class="form-text text-muted d-block">{{ form.signup_confirmation_timeout_minutes.help_text }}</small>{% endif %}
                            {% if form.signup_confirmation_timeout_minutes.errors %}<div class="invalid-feedback d-block">{{ form.signup_confirmation_timeout_minutes.errors }}</div>{% endif %}
                        </div>
                        <div class="mb-4">
                            <label for="{{ form.site_base_url.id_for_label }}" class="form-label">{{ form.site_base_url.label }}</label>
                            {{ form.site_base_url }}
                            {% if form.site_base_url.help_text %}<small class="form-text text-muted">{{ form.site_base_url.help_text }}</small>{% endif %}
                            {% if form.site_base_url.errors %}<div class="invalid-feedback d-block">{{ form.site_base_url.errors }}</div>{% endif %}
                        </div>
                        <button type="submit" class="btn btn-primary">Save settings</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
